<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Gérer les dépendances circulaires</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Entrepreneur, consultant, bio-sciences and software engineer."><meta name=author content="Nadia Humbert-Labeaumaz"><meta name=generator content="Hugo 0.82.1"><meta property="og:image" content="http://examplesite.org/images/blog/circular-dependencies/header.jpg"><meta property="og:title" content="Gérer les dépendances circulaires"><meta property="og:description" content="Durant mon travail, j&rsquo;ai rencontré des dépendances circulaires dans une application sur laquelle je suis intervenue. Dans sa plus simple forme, il s&rsquo;agit de deux classes qui dépendent l&rsquo;une de l&rsquo;autre."><meta property="og:type" content="article"><meta property="og:url" content="http://examplesite.org/blog/2016-12-17-gerer-les-dependances-circulaires/"><meta property="og:image" content="http://examplesite.org"><meta property="article:section" content="blog"><meta property="article:published_time" content="2016-12-17T18:31:18+01:00"><meta property="article:modified_time" content="2016-12-17T18:31:18+01:00"><meta property="og:site_name" content="Nadia Humbert-Labeaumaz"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://examplesite.org"><meta name=twitter:title content="Gérer les dépendances circulaires"><meta name=twitter:description content="Durant mon travail, j&rsquo;ai rencontré des dépendances circulaires dans une application sur laquelle je suis intervenue. Dans sa plus simple forme, il s&rsquo;agit de deux classes qui dépendent l&rsquo;une de l&rsquo;autre."><link rel=stylesheet href=/plugins/bootstrap/css/bootstrap.min.css media=screen><link rel=stylesheet href=/plugins/ionicons/css/ionicons.min.css><link rel=stylesheet href=/plugins/magnific-popup/magnific-popup.min.css><link rel=stylesheet href=/plugins/slick/slick.css><link rel=stylesheet href=/scss/style.min.css media=screen><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=icon href=/images/favicon.png type=image/x-icon></head><body><div class=preloader></div><header class=navigation><div class=container-fluid><div class=row><div class=col-md-12><nav class=navbar><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navigation>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Blog</a></li><li><a href=/categories/case-studies>Case Studies</a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>Videos <span class=ion-ios-arrow-down></span></a><ul class=dropdown-menu><li><a href=/crafties>Crafties</a></li></ul></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false>More <span class=ion-ios-arrow-down></span></a><ul class=dropdown-menu><li><a href=/drafties>Drafties</a></li><li><a href=/talks>Talks</a></li></ul></li><li><a href=/contact>Contact</a></li></ul></div></nav></div></div></div></header><section class="page-title bg-2" style=background-image:url(/images/blog/circular-dependencies/header.jpg)><div class=container><div class=row><div class=col-md-12><div class=block><h1>Gérer les dépendances circulaires</h1><p></p></div></div></div></div></section><section class=page-wrapper><div class=container><div class=row><div class=col-md-8><div class="post post-single"><h2 class=post-title>Gérer les dépendances circulaires</h2><div class=post-meta><ul><li><i class=ion-calendar></i> December 17, 2016</li><li><i class=ion-android-people></i>
Posted by
<a class=text-primary href=/author/nadia-humbert-labeaumaz>Nadia Humbert-Labeaumaz</a></li><li><i class=ion-pricetags></i>
<a href=/tags/software-design>Software Design</a>, <a href=/tags/java>Java</a></li></ul></div><div class=post-thumb><img class=img-responsive src=/images/blog/circular-dependencies/header.jpg alt="Gérer les dépendances circulaires"></div><div class="post-content post-excerpt"><p>Durant mon travail, j&rsquo;ai rencontré des dépendances circulaires dans une application sur laquelle je suis intervenue. Dans sa plus simple forme, il s&rsquo;agit de deux classes qui dépendent l&rsquo;une de l&rsquo;autre.
Ceci est, selon moi, un problème pour plusieurs raisons. L&rsquo;objectif de cet article est de montrer ce qu&rsquo;est une dépendance circulaire, en quoi cela peut poser problème, et comment les éliminer.</p><h2 id=cas-détude>Cas d&rsquo;étude</h2><p>Le code ci-dessous présente un cas simple de dépendance circulaire.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> B b<span style=color:#f92672>;</span>

  A<span style=color:#f92672>(</span>B b<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> b<span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    b<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something awesome!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>private</span> A a<span style=color:#f92672>;</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setA</span><span style=color:#f92672>(</span>A a<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> a<span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
      a<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something great!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=problèmes-associés>Problèmes associés</h2><h3 id=instanciation-de-b>Instanciation de b</h3><p>Le code suivant illustre l&rsquo;utilisation de <code>B</code> :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>B b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> B<span style=color:#f92672>();</span> <span style=color:#75715e>// 1
</span><span style=color:#75715e></span>A a <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> A<span style=color:#f92672>(</span>b<span style=color:#f92672>);</span>
b<span style=color:#f92672>.</span><span style=color:#a6e22e>setA</span><span style=color:#f92672>(</span>a<span style=color:#f92672>);</span> <span style=color:#75715e>// 2
</span><span style=color:#75715e></span>b<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomething</span><span style=color:#f92672>();</span> <span style=color:#75715e>// 3
</span></code></pre></div><p>Nous pouvons observer que la classe <code>B</code> ne peut pas être utilisée directement après son instanciation (<code>1</code>). Elle est dans un état incohérent car il est impératif de setter l&rsquo;instance de <code>A</code> (<code>2</code>) afin de pouvoir l&rsquo;utiliser. Sinon, une exception de type <code>NullPointerException</code> sera remontée lors de l&rsquo;appel de la méthode <code>doSomething</code> (<code>3</code>). Cette opération (<code>2</code>) peut facilement être oubliée. De plus, si l&rsquo;appel de la méthode (<code>3</code>) intervient bien plus tard, cet oubli peut ne pas être détecté immédiatemment.</p><h3 id=immuabilité-de-b>Immuabilité de B</h3><p>Un autre inconvénient est que <code>B</code> n&rsquo;est pas immuable. En effet, une fois instancié, il est possible de modifier son état en appelant autant de fois que l&rsquo;on veut la méthode <code>setA</code>.
Pour rendre <code>B</code> immuable, il faudrait supprimer le setter, rendre l&rsquo;attribut <code>a</code> <code>final</code> et le passer en paramètre du constructeur. Ceci est impossible actuellement à cause de la dépendance circulaire.</p><h3 id=fort-couplage>Fort couplage</h3><p>Le fort couplage introduit entre les deux classes peut être un signe qu&rsquo;il y a un problème de séparation des responsabilités. Il est, par exemple, possible que les deux classes partagent la même responsabilité et qu&rsquo;elles puissent donc être fusionnées. Une autre possibilité est qu&rsquo;une troisième responsabilité soit présente et qu&rsquo;elle doive être extraite dans une classe séparée.</p><h2 id=solutions-envisageables>Solutions envisageables</h2><p>Dans le contexte de mon travail, les solutions que j&rsquo;ai dû adopter étaient relativement simples. Ces solutions seront décrites par la suite.</p><h3 id=déplacer-le-comportement-dans-une-des-deux-classes>Déplacer le comportement dans une des deux classes</h3><p>Il est possible que le comportement de <code>doSomethingAwesome</code> soit lié uniquement à la classe <code>B</code>. Dans ce cas, il est possible de déplacer cette méthode dans <code>B</code> :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> B b<span style=color:#f92672>;</span>

  A<span style=color:#f92672>(</span>B b<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> b<span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    b<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    b<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
      doSomethingAwesome<span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something great!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something awesome!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Il n&rsquo;y a donc plus de dépendance circulaire car <code>B</code> ne dépend plus de <code>A</code>. Le code est ainsi plus SOLID car la classe <code>A</code> n&rsquo;a plus de responsabilités qui ne lui appartiennent pas.</p><p>Le code ci-dessus a été écrit de manière à conserver l&rsquo;API de <code>A</code>. La méthode <code>doSomethingAwesome</code> de <code>A</code> pourrait donc être supprimée si elle n&rsquo;est désormais plus appelée.</p><h3 id=créer-une-nouvelle-classe>Créer une nouvelle classe</h3><p>Si la méthode <code>doSomethingAwesome</code> n&rsquo;est une responsabilité ni de <code>A</code> ni de <code>B</code>, elle doit être extraite dans une classe séparée :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Awesome</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something awesome!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> B b<span style=color:#f92672>;</span>
  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Awesome awesome<span style=color:#f92672>;</span>

  A<span style=color:#f92672>(</span>B b<span style=color:#f92672>,</span> Awesome awesome<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> b<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>awesome</span> <span style=color:#f92672>=</span> awesome<span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    b<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    awesome<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Awesome awesome<span style=color:#f92672>;</span>

  B<span style=color:#f92672>(</span>Awesome awesome<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>awesome</span> <span style=color:#f92672>=</span> awesome<span style=color:#f92672>;</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomething</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    awesome<span style=color:#f92672>.</span><span style=color:#a6e22e>doSomethingAwesome</span><span style=color:#f92672>();</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doSomethingGreat</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Doing something great!&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=conclusion>Conclusion</h2><p>Les dépendances circulaires peuvent être un signe de mauvais design. En effet, elles introduisent un fort couplage, provoquent l&rsquo;instanciation d&rsquo;objets incohérents et empêchent l&rsquo;immuabilité de ceux-ci. Il est donc nécessaire de les analyser afin de bien comprendre leur origine et de les corriger si besoin. Dans cet article, deux manières de faire ont été présentées.</p></div><div class=post-comments></div></div></div><div class=col-md-4><aside class=sidebar><div class="widget widget-latest-post"><h4 class=widget-title>Latest Posts</h4><div class=media><a class=pull-left href=/blog/2021-01-14-what-is-a-social-entrepreneur/><img class=media-object src=/images/blog/what-is-a-social-entrepreneur/header.jpg alt="What is a Social Entrepreneur?"></a><div class=media-body><h4 class=media-heading><a href=/blog/2021-01-14-what-is-a-social-entrepreneur/>What is a Social Entrepreneur?</a></h4></div></div><div class=media><a class=pull-left href=/blog/2020-02-13-transformation-assessment/><img class=media-object src=/images/blog/transformation-assessment/header.jpg alt="Assessment of XYZ’s IT Business Unit Transformation"></a><div class=media-body><h4 class=media-heading><a href=/blog/2020-02-13-transformation-assessment/>Assessment of XYZ’s IT Business Unit Transformation</a></h4></div></div><div class=media><a class=pull-left href=/blog/2019-10-29-opex-during-scale-up/><img class=media-object src=/images/blog/opex-scale-up/header.jpg alt="Operational Excellence to Ensure Value Delivery During XYZ's Scale-Up"></a><div class=media-body><h4 class=media-heading><a href=/blog/2019-10-29-opex-during-scale-up/>Operational Excellence to Ensure Value Delivery During XYZ's Scale-Up</a></h4></div></div><div class=media><a class=pull-left href=/blog/2019-06-27-cloudy-relationship-france-diesel/><img class=media-object src=/images/blog/diesel/header.jpg alt="The Cloudy Relationship Between France and Diesel"></a><div class=media-body><h4 class=media-heading><a href=/blog/2019-06-27-cloudy-relationship-france-diesel/>The Cloudy Relationship Between France and Diesel</a></h4></div></div></div><div class="widget widget-category"><h4 class=widget-title>Categories</h4><ul class=widget-category-list><li><a href=/categories/business/>Business</a></li><li><a href=/categories/case-studies/>Case Studies</a></li><li><a href=/categories/software/>Software</a></li></ul></div><div class="widget widget-tag"><h4 class=widget-title>Tags</h4><ul class=widget-tag-list><li><a href=/tags/change-management/>Change Management</a></li><li><a href=/tags/economics/>Economics</a></li><li><a href=/tags/java/>Java</a></li><li><a href=/tags/operational-excellence/>Operational Excellence</a></li><li><a href=/tags/refactoring/>Refactoring</a></li><li><a href=/tags/social-entrepreneurship/>Social Entrepreneurship</a></li><li><a href=/tags/software-design/>Software Design</a></li><li><a href=/tags/software-testing/>Software Testing</a></li></ul></div></aside></div></div></div></section><footer class=footer><div class=container><div class=row><div class=col-md-12><div class=footer-menu><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=/experience>Experience</a></li><li><a href=/blog>Blog</a></li><li><a href=/categories/case-studies>Case Studies</a></li><li><a href=/contact>Contact</a></li></ul></div><p class=copyright>Nadia Humbert-Labeaumaz • 2021</p></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script><script src=/plugins/bootstrap/js/bootstrap.min.js></script><script src=/plugins/slick/slick.min.js></script><script src=/plugins/magnific-popup/magnific-popup.min.js></script><script src=/plugins/shuffle/shuffle.min.js></script><script src=/plugins/google-map/gmap.js defer></script><script src=/js/script.min.js></script></body></html>